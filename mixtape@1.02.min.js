function generateShareURL(){const e=window.location.origin+window.location.pathname,t=JSON.parse(localStorage.getItem("soundtrackMap")||"{}"),o=JSON.parse(localStorage.getItem("bioMap")||"{}"),a=JSON.parse(localStorage.getItem("videoMap")||"{}"),n=localStorage.getItem("mixtapeDescription")||"",i=new URLSearchParams;return Object.keys(t).length>0&&i.append("soundtracks",encodeURIComponent(Object.keys(t).join("_"))),Object.keys(o).length>0&&i.append("bios",encodeURIComponent(Object.keys(o).join("_"))),Object.keys(a).length>0&&i.append("videos",encodeURIComponent(Object.keys(a).join("_"))),n&&i.append("description",encodeURIComponent(n)),`${e}?${i.toString()}`}let generateLinkElements=document.querySelectorAll('[data-generate="link"]');function initializePlyrForElement(e){window.plyrInstancesMap||(window.plyrInstancesMap=new Map);const t=new Plyr(e,{controls:["play","progress","current-time"]});window.plyrInstancesMap.set(e,t)}generateLinkElements.length>0&&generateLinkElements.forEach((e=>{e.addEventListener("click",(function(){let t=e.querySelector('[data-generate="text"]'),o=e.getAttribute("data-success")||"Link copied!",a=generateShareURL();navigator.clipboard.writeText(a).then((()=>{t&&(t.textContent=o)})).catch((e=>{console.warn("Failed to copy: ",e),t&&(t.textContent="Failed to copy link")})),setTimeout((()=>{t&&(t.textContent="Generate share link")}),2e3)}))}));let videoMap=JSON.parse(localStorage.getItem("videoMap")||"{}"),bioMap=JSON.parse(localStorage.getItem("bioMap")||"{}"),soundtracksMap=JSON.parse(localStorage.getItem("soundtrackMap")||"{}");function initSoundtracks(e){const t=document.querySelector(".mixtape-sounds"),o=t.querySelector(".mixtape-item"),a=t.parentElement,n=a.querySelector("[data-mixtape-empty]"),i=Object.entries(e);0===i.length?(gsap.set(n,{display:"block"}),gsap.set(t,{display:"none"})):(gsap.set(n,{display:"none"}),i.forEach((([e,{src:a,name:n,project:i}])=>{o.remove();const r=o.cloneNode(!0),c=r.querySelector(".audio-player");if(c){c.setAttribute("data-audio-id",e),c.setAttribute("data-audio-src",a),c.setAttribute("data-audio-name",n),c.setAttribute("data-audio-project",i);const t=r.querySelector(".h-h5"),o=r.querySelector(".eyebrow_14");t&&(t.textContent=n),o&&(o.textContent=i)}t.appendChild(r)})),t.querySelectorAll(".audio-player").forEach((e=>{let t=e.getAttribute("data-audio-src");createPlayer(e,t)}))),t.querySelectorAll("[data-remove]").forEach((e=>{e.addEventListener("click",(function(){const e=this.closest(".mixtape-item");if(e){const t=e.querySelector(".audio-player").getAttribute("data-audio-id");e.remove(),currentPlaying.pause();let o=JSON.parse(localStorage.getItem("soundtrackMap")||"{}");delete o[t],localStorage.setItem("soundtrackMap",JSON.stringify(o)),updateMixtapeCount(),0===Object.keys(o).length&&gsap.set(n,{display:"block"})}}))}));a.querySelector("[data-remove-all]").addEventListener("click",(function(){t.querySelectorAll(".mixtape-item").forEach((e=>e.remove())),localStorage.setItem("soundtrackMap","{}"),updateMixtapeCount(),gsap.set(n,{display:"block"}),currentPlaying&&currentPlaying.pause()}))}function initBios(e){const t=document.querySelector(".mixtape-bios"),o=t.querySelector(".mixtape-item"),a=t.parentElement,n=a.querySelector("[data-mixtape-empty]"),i=Object.entries(e);0===i.length?(gsap.set(n,{display:"block"}),gsap.set(t,{display:"none"})):(gsap.set(n,{display:"none"}),i.forEach((([e,a])=>{o.remove();const n=o.cloneNode(!0),i=n.querySelector("[data-bio-name]"),r=n.querySelector("[data-bio-content]");i&&r&&(i.textContent=e,r.textContent=a),t.appendChild(n)}))),t.querySelectorAll("[data-remove]").forEach((t=>{t.addEventListener("click",(function(){const t=this.closest(".mixtape-item");if(t){const o=t.querySelector("[data-bio-name]").textContent;t.remove(),delete e[o],localStorage.setItem("bioMap",JSON.stringify(e)),updateMixtapeCount(),0===Object.entries(e).length&&gsap.set(n,{display:"block"})}}))}));a.querySelector("[data-remove-all]").addEventListener("click",(function(){t.querySelectorAll(".mixtape-item").forEach((e=>e.remove())),localStorage.setItem("bioMap","{}"),updateMixtapeCount(),gsap.set(n,{display:"block"})}))}function initVideos(e){const t=document.querySelector(".mixtape-vids"),o=t.querySelector(".mixtape-item"),a=t.parentElement,n=a.querySelector("[data-mixtape-empty]"),i=Object.entries(e);0===i.length?(gsap.set(n,{display:"block"}),gsap.set(t,{display:"none"})):(gsap.set(n,{display:"none"}),i.forEach((([e,a])=>{o.remove();const n=o.cloneNode(!0),i=n.querySelector(".mixtape-embed"),r=n.querySelector(".plyr__video-embed"),c=n.querySelector(".vid-wrap");i&&(c.setAttribute("data-video-src",a),c.setAttribute("data-video-id",e),i.setAttribute("title",e),i.setAttribute("src",`https://player.vimeo.com/video/${a}?loop=false&byline=false&portrait=false&title=false&transparent=0&gesture=media`),initializePlyrForElement(r)),t.appendChild(n)}))),t.querySelectorAll("[data-remove]").forEach((t=>{t.addEventListener("click",(function(){const t=this.closest(".mixtape-item");if(t){const o=t.querySelector(".vid-wrap").getAttribute("data-video-id");t.remove(),delete e[o],localStorage.setItem("videoMap",JSON.stringify(e)),updateMixtapeCount(),0===Object.entries(e).length&&gsap.set(n,{display:"block"})}}))}));a.querySelector("[data-remove-all]").addEventListener("click",(function(){t.querySelectorAll(".mixtape-item").forEach((e=>e.remove())),localStorage.setItem("videoMap","{}"),updateMixtapeCount(),gsap.set(n,{display:"block"})}))}const description=document.querySelector("[data-mixtape-description]"),saveMixtapeDescription=()=>{const e=description.textContent;localStorage.setItem("mixtapeDescription",e)},savedDescription=localStorage.getItem("mixtapeDescription");function populateSoundtracksFromURL(){const e=new URLSearchParams(window.location.search).get("soundtracks");if(e){const t=e.split("_"),o={};t.forEach((e=>{const t=document.querySelector(`#soundtrack-ids [data-audio-id="${e}"]`);if(t){const a=t.getAttribute("data-audio-src"),n=t.getAttribute("data-audio-name"),i=t.getAttribute("data-audio-project");o[e]={src:a,name:n,project:i}}})),Object.keys(o).length>0&&localStorage.setItem("soundtrackMap",JSON.stringify(o))}}function populateVideosFromURL(){const e=new URLSearchParams(window.location.search).get("videos");if(e){const t=decodeURIComponent(e).split("_"),o={};t.forEach((e=>{const t=document.querySelector(`#video-ids [data-video-id="${e}"]`);if(t){const a=t.getAttribute("data-video-src");o[e]=a}})),Object.keys(o).length>0&&localStorage.setItem("videoMap",JSON.stringify(o))}}function populateBiosFromURL(){const e=new URLSearchParams(window.location.search),t=decodeURIComponent(e.get("bios"));if(t){const e=t.split("_"),o={};e.forEach((e=>{const t=document.querySelector(`#bio-ids [data-bio-id="${e}"]`);if(t){const a=t.textContent;o[e]=a}})),Object.keys(o).length>0&&localStorage.setItem("bioMap",JSON.stringify(o))}}function populateDescriptionFromURL(){const e=new URLSearchParams(window.location.search).get("description");if(e){const t=decodeURIComponent(e);localStorage.setItem("mixtapeDescription",t),description&&(description.textContent=t)}}savedDescription&&(description.textContent=savedDescription),description.addEventListener("input",saveMixtapeDescription),document.addEventListener("DOMContentLoaded",(()=>{populateSoundtracksFromURL(),populateVideosFromURL(),populateBiosFromURL(),populateDescriptionFromURL();let e=JSON.parse(localStorage.getItem("videoMap")||"{}"),t=JSON.parse(localStorage.getItem("bioMap")||"{}");initSoundtracks(JSON.parse(localStorage.getItem("soundtrackMap")||"{}")),initBios(t),initVideos(e),updateMixtapeCount()}));
