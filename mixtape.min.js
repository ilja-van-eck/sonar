function generateShareURL(){let e=window.location.origin+window.location.pathname,t=JSON.parse(localStorage.getItem("soundtrackMap")||"{}"),i=JSON.parse(localStorage.getItem("bioMap")||"{}"),a=JSON.parse(localStorage.getItem("videoMap")||"{}"),o=localStorage.getItem("mixtapeDescription")||"",r=new URLSearchParams;return Object.keys(t).length>0&&r.append("soundtracks",encodeURIComponent(Object.keys(t).join("_"))),Object.keys(i).length>0&&r.append("bios",encodeURIComponent(Object.keys(i).join("_"))),Object.keys(a).length>0&&r.append("videos",encodeURIComponent(Object.keys(a).join("_"))),o&&r.append("description",encodeURIComponent(o)),`${e}?${r.toString()}`}let generateLink=document.querySelector('[data-generate="link"]');function initializePlyrForElement(e){window.plyrInstancesMap||(window.plyrInstancesMap=new Map);let t=new Plyr(e,{controls:["play","progress","current-time"]});window.plyrInstancesMap.set(e,t)}generateLink.addEventListener("click",function(){linkText=generateLink.querySelector('[data-generate="text"]'),linkSuccessText=generateLink.getAttribute("data-success"),shareUrl=generateShareURL(),navigator.clipboard.writeText(shareUrl).then(()=>{linkText.textContent=linkSuccessText}).catch(e=>{console.warn("Failed to copy: ",e),linkText.textContent="Failed to copy link"}),setTimeout(()=>{linkText.textContent="Generate share link"},2e3)});let videoMap=JSON.parse(localStorage.getItem("videoMap")||"{}"),bioMap=JSON.parse(localStorage.getItem("bioMap")||"{}"),soundtracksMap=JSON.parse(localStorage.getItem("soundtrackMap")||"{}");function initSoundtracks(e){let t=document.querySelector(".mixtape-sounds"),i=t.querySelector(".mixtape-item"),a=t.parentElement,o=a.querySelector("[data-mixtape-empty]"),r=Object.entries(e);if(0===r.length)gsap.set(o,{display:"block"}),gsap.set(t,{display:"none"});else{gsap.set(o,{display:"none"});let[n,l]=r[0],s=i.querySelector(".audio-player");s&&(s.setAttribute("data-audio-id",n),s.setAttribute("data-audio-src",l));for(let d=1;d<r.length;d++){let[c,p]=r[d],u=i.cloneNode(!0),m=u.querySelector(".audio-player");m&&(m.setAttribute("data-audio-id",c),m.setAttribute("data-audio-src",p)),t.appendChild(u)}t.querySelectorAll(".audio-player").forEach(e=>{let t=e.getAttribute("data-audio-src");createPlayer(e,t)})}t.querySelectorAll("[data-remove]").forEach(e=>{e.addEventListener("click",function(){let e=this.closest(".mixtape-item");if(e){let t=e.querySelector(".audio-player").getAttribute("data-audio-id");e.remove(),currentPlaying.pause();let i=JSON.parse(localStorage.getItem("soundtrackMap")||"{}");delete i[t],localStorage.setItem("soundtrackMap",JSON.stringify(i)),updateMixtapeCount(),0===Object.keys(i).length&&gsap.set(o,{display:"block"})}})});let y=a.querySelector("[data-remove-all]");y.addEventListener("click",function(){t.querySelectorAll(".mixtape-item").forEach(e=>e.remove()),localStorage.setItem("soundtrackMap","{}"),updateMixtapeCount(),gsap.set(o,{display:"block"}),currentPlaying&&currentPlaying.pause()})}function initBios(e){let t=document.querySelector(".mixtape-bios"),i=t.querySelector(".mixtape-item"),a=t.parentElement,o=a.querySelector("[data-mixtape-empty]"),r=Object.entries(e);0===r.length?(gsap.set(o,{display:"block"}),gsap.set(t,{display:"none"})):(gsap.set(o,{display:"none"}),r.forEach(([e,a])=>{i.remove();let o=i.cloneNode(!0),r=o.querySelector("[data-bio-name]"),n=o.querySelector("[data-bio-content]");r&&n&&(r.textContent=e,n.textContent=a),t.appendChild(o)})),t.querySelectorAll("[data-remove]").forEach(t=>{t.addEventListener("click",function(){let t=this.closest(".mixtape-item");if(t){let i=t.querySelector("[data-bio-name]").textContent;t.remove(),delete e[i],localStorage.setItem("bioMap",JSON.stringify(e)),updateMixtapeCount(),0===Object.entries(e).length&&gsap.set(o,{display:"block"})}})});let n=a.querySelector("[data-remove-all]");n.addEventListener("click",function(){t.querySelectorAll(".mixtape-item").forEach(e=>e.remove()),localStorage.setItem("bioMap","{}"),updateMixtapeCount(),gsap.set(o,{display:"block"})})}function initVideos(e){let t=document.querySelector(".mixtape-vids"),i=t.querySelector(".mixtape-item"),a=t.parentElement,o=a.querySelector("[data-mixtape-empty]"),r=Object.entries(e);0===r.length?(gsap.set(o,{display:"block"}),gsap.set(t,{display:"none"})):(gsap.set(o,{display:"none"}),r.forEach(([e,a])=>{i.remove();let o=i.cloneNode(!0),r=o.querySelector(".mixtape-embed"),n=o.querySelector(".plyr__video-embed"),l=o.querySelector(".vid-wrap");r&&(l.setAttribute("data-video-src",a),l.setAttribute("data-video-id",e),r.setAttribute("title",e),r.setAttribute("src",`https://player.vimeo.com/video/${a}?loop=false&byline=false&portrait=false&title=false&transparent=0&gesture=media`),initializePlyrForElement(n)),t.appendChild(o)})),t.querySelectorAll("[data-remove]").forEach(t=>{t.addEventListener("click",function(){let t=this.closest(".mixtape-item");if(t){let i=t.querySelector(".vid-wrap").getAttribute("data-video-id");t.remove(),delete e[i],localStorage.setItem("videoMap",JSON.stringify(e)),updateMixtapeCount(),0===Object.entries(e).length&&gsap.set(o,{display:"block"})}})});let n=a.querySelector("[data-remove-all]");n.addEventListener("click",function(){t.querySelectorAll(".mixtape-item").forEach(e=>e.remove()),localStorage.setItem("videoMap","{}"),updateMixtapeCount(),gsap.set(o,{display:"block"})})}const description=document.querySelector("[data-mixtape-description]"),saveMixtapeDescription=()=>{let e=description.textContent;localStorage.setItem("mixtapeDescription",e)},savedDescription=localStorage.getItem("mixtapeDescription");function populateSoundtracksFromURL(){let e=new URLSearchParams(window.location.search),t=e.get("soundtracks");if(t){let i=t.split("_"),a={};i.forEach(e=>{let t=document.querySelector(`#soundtrack-ids [data-audio-id="${e}"]`);if(t){let i=t.getAttribute("data-audio-src");a[e]=i}}),Object.keys(a).length>0&&localStorage.setItem("soundtrackMap",JSON.stringify(a))}}function populateVideosFromURL(){let e=new URLSearchParams(window.location.search),t=e.get("videos");if(t){let i=decodeURIComponent(t),a=i.split("_"),o={};a.forEach(e=>{let t=document.querySelector(`#video-ids [data-video-id="${e}"]`);if(t){let i=t.getAttribute("data-video-src");o[e]=i}}),Object.keys(o).length>0&&localStorage.setItem("videoMap",JSON.stringify(o))}}function populateBiosFromURL(){let e=new URLSearchParams(window.location.search),t=decodeURIComponent(e.get("bios"));if(t){let i=t.split("_"),a={};i.forEach(e=>{let t=document.querySelector(`#bio-ids [data-bio-id="${e}"]`);if(t){let i=t.textContent;a[e]=i}}),Object.keys(a).length>0&&localStorage.setItem("bioMap",JSON.stringify(a))}}function populateDescriptionFromURL(){let e=new URLSearchParams(window.location.search),t=e.get("description");if(t){let i=decodeURIComponent(t);localStorage.setItem("mixtapeDescription",i),description&&(description.textContent=i)}}savedDescription&&(description.textContent=savedDescription),description.addEventListener("input",saveMixtapeDescription),document.addEventListener("DOMContentLoaded",()=>{populateSoundtracksFromURL(),populateVideosFromURL(),populateBiosFromURL(),populateDescriptionFromURL();let e=JSON.parse(localStorage.getItem("videoMap")||"{}"),t=JSON.parse(localStorage.getItem("bioMap")||"{}");initSoundtracks(JSON.parse(localStorage.getItem("soundtrackMap")||"{}")),initBios(t),initVideos(e),updateMixtapeCount()});
