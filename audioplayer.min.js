let isListOpen=!1;const soundtrackButton=document.querySelector("[data-soundtrack-button]"),openState=document.querySelector(".st-open"),originalParent=document.querySelector(".soundtrack-list");function toggleList(){if(isListOpen){let e=Flip.getState(".st-list__inner");gsap.to(".st-list__item",{autoAlpha:0,y:"50%",duration:.4,ease:"power2.in",stagger:{each:.05,from:"end"},onComplete(){originalParent.appendChild(document.querySelector(".st-list__inner")),Flip.from(e,{absolute:!0,duration:1,ease:"expo.out",onComplete(){openState.style.display="none"}})}})}else{openState.style.display="block";let t=Flip.getState(".st-list__inner");openState.appendChild(document.querySelector(".st-list__inner")),Flip.from(t,{absolute:!0,duration:1,ease:"expo.out",onStart(){gsap.to(".st-list__item",{autoAlpha:1,y:0,duration:.6,ease:"power3.out",stagger:{each:.1}})}})}isListOpen=!isListOpen}soundtrackButton&&soundtrackButton.addEventListener("click",toggleList),document.addEventListener("keydown",function(e){"Escape"===e.key&&isListOpen&&toggleList()}),document.addEventListener("click",function(e){isListOpen&&!e.target.closest(".st-list__inner")&&toggleList()});let players=[],currentPlaying=null,isDragging;function createPlayer(e,t){let r=new Howl({src:[t],html5:!0,onplay(){updateCurrentPlaying(r,e)},onend(){resetPlayerUI(e)}});return r._audioElement=e,attachPlayerEvents(r,e),players.push(r),r}function updateCurrentPlaying(e,t){if(currentPlaying&&currentPlaying!==e){currentPlaying.pause();let r=currentPlaying._audioElement,n=r.parentElement.querySelector(".lines-wrapper.is-work");r.querySelector(".audio-btn__wrap").classList.remove("playing"),stopAnimation(n)}currentPlaying=e;t.querySelector(".audio-btn__wrap").classList.add("playing");startAnimation(t.parentElement.querySelector(".lines-wrapper.is-work"))}function attachPlayerEvents(e,t){let r=t.querySelector(".audio-btn__wrap"),n=t.querySelector(".audio-progress"),a=t.querySelector(".audio-track"),i=t.parentElement.querySelector(".lines-wrapper.is-work");r.addEventListener("click",()=>{e.playing()?(e.pause(),r.classList.remove("playing"),stopAnimation(i)):(e.play(),r.classList.add("playing"),startAnimation(i))}),e.on("play",()=>{requestAnimationFrame(()=>updateProgressBar(e,n))}),isDragging=!1,a.addEventListener("mousedown",t=>{isDragging=!0,updateProgress(t,e,n,a)}),document.addEventListener("mousemove",t=>{isDragging&&updateProgress(t,e,n,a)}),document.addEventListener("mouseup",()=>{isDragging=!1}),a.addEventListener("touchstart",t=>{isDragging=!0,updateProgress(t,e,n,a)}),document.addEventListener("touchmove",t=>{isDragging&&updateProgress(t,e,n,a)}),document.addEventListener("touchend",()=>{isDragging=!1})}function updateProgress(e,t,r,n){let a=n.getBoundingClientRect(),i=((e.clientX||e.touches[0].clientX)-a.left)/a.width;i=Math.max(0,Math.min(1,i)),r.style.width=100*i+"%";let s=t.duration()*i;t.seek(s)}function updateProgressBar(e,t){if(!isDragging&&e.playing()){let r=e.seek()/e.duration()*100;t.style.width=r+"%",requestAnimationFrame(()=>updateProgressBar(e,t))}}function resetPlayerUI(e){e.querySelector(".audio-progress").style.width="0%"}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".audio-player").forEach(e=>{let t=e.getAttribute("data-audio-src");createPlayer(e,t)})});
