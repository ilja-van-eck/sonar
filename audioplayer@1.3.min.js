let isListOpen=!1;const soundtrackButton=document.querySelector("[data-soundtrack-button]"),openState=document.querySelector(".st-open"),originalParent=document.querySelector(".soundtrack-list"),videoPlayers=document.querySelectorAll(".plyr__video-embed");function pauseAllAudioPlayers(){if(void 0!==currentPlaying&&currentPlaying){currentPlaying.pause();let e=currentPlaying._audioElement;if(e){let t=e.parentElement.querySelector(".lines-wrapper.is-work"),n=e.querySelector(".audio-btn__wrap");n&&n.classList.remove("playing"),t&&stopAnimation(t)}}}function pauseAllVideos(){videoPlayers.forEach((e=>{const t=e.closest(".plyr.plyr--full-ui.plyr--video.plyr--vimeo");if(t){const e=plyrInstancesMap.get(t);e&&e.pause()}}))}function toggleList(){if(isListOpen){const e=Flip.getState(".st-list__inner");gsap.to(".st-list__item",{autoAlpha:0,y:"50%",overwrite:!0,duration:.4,ease:"power2.in",stagger:{amount:.25,from:"end"},onComplete:()=>{originalParent.appendChild(document.querySelector(".st-list__inner")),Flip.from(e,{absolute:!0,duration:1,overwrite:!0,ease:"expo.out",onComplete:()=>{openState.style.display="none"}})}})}else{openState.style.display="block";const e=Flip.getState(".st-list__inner");openState.appendChild(document.querySelector(".st-list__inner")),Flip.from(e,{absolute:!0,duration:1,ease:"expo.out",overwrite:!0,onStart:()=>{gsap.to(".st-list__item",{autoAlpha:1,y:0,duration:.6,ease:"power3.out",overwrite:!0,stagger:{amount:.25}})}})}isListOpen=!isListOpen}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".plyr.plyr--full-ui.plyr--video.plyr--vimeo");plyrInstancesMap.get(e).on("play",(()=>{pauseAllAudioPlayers()}))})),soundtrackButton&&soundtrackButton.addEventListener("click",toggleList),document.addEventListener("keydown",(function(e){"Escape"===e.key&&isListOpen&&toggleList()})),document.addEventListener("click",(function(e){isListOpen&&!e.target.closest(".st-list__inner")&&toggleList()}));let isDragging,players=[],currentPlaying=null;function createPlayer(e,t){let n=new Howl({src:[t],html5:!0,onplay:()=>{updateCurrentPlaying(n,e)},onend:()=>{resetPlayerUI(e)}});return n._audioElement=e,attachPlayerEvents(n,e),players.push(n),n}function updateCurrentPlaying(e,t){if(currentPlaying&&currentPlaying!==e){currentPlaying.pause();let e=currentPlaying._audioElement,t=e.parentElement.querySelector(".lines-wrapper.is-work");e.querySelector(".audio-btn__wrap").classList.remove("playing"),t&&stopAnimation(t)}currentPlaying=e,t.querySelector(".audio-btn__wrap").classList.add("playing");let n=t.parentElement.querySelector(".lines-wrapper.is-work");n&&startAnimation(n)}function attachPlayerEvents(e,t){let n=t.querySelector(".audio-btn__wrap"),r=t.querySelector(".audio-progress"),i=t.querySelector(".audio-track");t.parentElement.querySelector(".lines-wrapper.is-work");n.addEventListener("click",(function(){if(pauseAllVideos(),e.playing()){e.pause(),currentPlaying._audioElement.querySelector(".audio-btn__wrap").classList.remove("playing");let t=currentPlaying._audioElement.parentElement.querySelector(".lines-wrapper.is-work");t&&stopAnimation(t)}else{if(currentPlaying&&currentPlaying!=e){currentPlaying.pause(),currentPlaying._audioElement.querySelector(".audio-btn__wrap").classList.remove("playing");let e=currentPlaying._audioElement.parentElement.querySelector(".lines-wrapper.is-work");e&&stopAnimation(e)}e.play(),currentPlaying=e}})),e.on("play",(()=>{requestAnimationFrame((()=>updateProgressBar(e,r)))})),isDragging=!1,i.addEventListener("mousedown",(t=>{isDragging=!0,updateProgress(t,e,r,i)})),document.addEventListener("mousemove",(t=>{isDragging&&updateProgress(t,e,r,i)})),document.addEventListener("mouseup",(()=>{isDragging=!1})),i.addEventListener("touchstart",(t=>{isDragging=!0,updateProgress(t,e,r,i)})),document.addEventListener("touchmove",(t=>{isDragging&&updateProgress(t,e,r,i)})),document.addEventListener("touchend",(()=>{isDragging=!1}))}function updateProgress(e,t,n,r){let i=r.getBoundingClientRect(),a=((e.clientX||e.touches[0].clientX)-i.left)/i.width;a=Math.max(0,Math.min(1,a)),n.style.width=100*a+"%";let o=t.duration()*a;t.seek(o)}function updateProgressBar(e,t){if(!isDragging&&e.playing()){let n=e.seek()/e.duration()*100;t.style.width=n+"%",requestAnimationFrame((()=>updateProgressBar(e,t)))}}function resetPlayerUI(e){e.querySelector(".audio-progress").style.width="0%"}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".plyr__video-embed");document.querySelectorAll(".audio-btn__wrap").forEach((e=>{const t=e.closest(".audio-player");e.addEventListener("click",(function(){let e=t.getAttribute("data-audio-src"),n=players.find((e=>e._audioElement===t));n||(n=createPlayer(t,e),n.play(),pauseAllVideos())}),!1)}))}));
